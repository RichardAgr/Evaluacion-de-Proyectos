import{c as k,j as e,h as b,p as F,q as d,t as I,M as R,B as s,T as C,F as z,v as M,w as u,I as j,x as T,y as N}from"./index-D2PNLU1G.js";const W=k(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6m0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20"}),"AccountCircle"),y=k(e.jsx("path",{d:"M14 11c0 .55-.45 1-1 1H4c-.55 0-1-.45-1-1s.45-1 1-1h9c.55 0 1 .45 1 1M3 7c0 .55.45 1 1 1h9c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1m7 8c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1h5c.55 0 1-.45 1-1m8.01-2.13.71-.71c.39-.39 1.02-.39 1.41 0l.71.71c.39.39.39 1.02 0 1.41l-.71.71zm-.71.71-5.16 5.16c-.09.09-.14.21-.14.35v1.41c0 .28.22.5.5.5h1.41c.13 0 .26-.05.35-.15l5.16-5.16z"}),"EditNoteRounded"),G=async()=>{const c="http://localhost:8000/api/obtenerDatosDocente",m={method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"};try{return await(await fetch(c,m)).json()}catch(n){console.error("Error:",n)}},H=async()=>{const c="http://localhost:8000/api/obtenerDatosEstudiante",m={method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"};try{return await(await fetch(c,m)).json()}catch(n){console.error("Error:",n)}},O=async(c,m)=>{const n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m),credentials:"include"};try{const i=await fetch(c,n);if(!i.ok)throw new Error(`Error en la petición: ${i.statusText}`);return await i.json()}catch(i){throw console.error("Error en la actualización:",i),i}},J=({openPerfil:c,cerrarPerfil:m,role:n})=>{const i=localStorage.getItem("nombreCompleto"),[h,g]=b.useState({open:!1,message:"",severity:"info"}),[p,f]=b.useState({nombreCuenta:!1,contrasena:!1,repetirContrasena:!1,correo:!1,nombre:!1,apellido:!1,segundoApellido:!1,verificarSiEsElUsuario:!1}),[x,E]=b.useState(!1),[S,A]=b.useState({nombreCuenta:"",contrasena:"",repetirContrasena:"",correo:"",nombre:"",apellido:"",segundoApellido:""}),v=(a,t)=>{if(f(o=>({...o,[a]:!o[a]})),p[a]&&t(a,S[a]),a==="repetirContrasena"||a==="segundoApellido"){const o=a==="repetirContrasena"?"contrasena":"apellido";f(r=>({...r,[o]:!r[o]})),p[a]||t(o,S[o])}},U=async()=>{try{const a=await H();A({...a,verificarSiEsElUsuario:"",contrasena:"Ejemplo1",repetirContrasena:"Ejemplo1"})}catch(a){console.error("Error al obtener datos del estudiante:",a)}},B=async()=>{try{const a=await G();A({...a,verificarSiEsElUsuario:"",contrasena:"Ejemplo1",repetirContrasena:"Ejemplo1"})}catch(a){console.error("Error al obtener datos del docente:",a)}};b.useEffect(()=>{c&&(n==="docente"?B():U())},[c,n]);const D=F({nombre:d().trim().required("El nombre es obligatorio"),apellido:d().trim().required("El apellido paterno es obligatorio"),segundoApellido:d().trim().required("El apellido materno es obligatorio"),correo:d().email("El correo no tiene un formato válido").required("El correo es obligatorio"),nombreCuenta:d().trim().required("El nombre de la cuenta es obligatorio"),contrasena:d().min(8,"La contraseña debe tener al menos 8 caracteres").matches(/[A-Z]/,"La contraseña debe tener al menos una letra mayúscula").matches(/[0-9]/,"La contraseña debe tener al menos un número").required("la contraseña es obligatorio"),repetirContrasena:d().oneOf([I("contrasena"),null],"Las contraseñas no coinciden").required("la contraseña es obligatorio"),verificarSiEsElUsuario:d().required("Debe confirmar su contraseña actual")}),L=async a=>{const t={contrasena:a.verificarSiEsElUsuario,nombre:a.nombre,primerApellido:a.apellido,segundoApellido:a.segundoApellido,email:a.correo,nuevaContrasena:a.contrasena};console.log(t);const o=n==="docente"?"http://localhost:8000/api/modificarDatosDocente":"http://localhost:8000/api/modificarDatosEstudiante";try{const r=await O(o,t);(r==null?void 0:r.mensaje)==="success"?(alert(r.message),f({nombreCuenta:!1,contrasena:!1,repetirContrasena:!1,correo:!1,nombre:!1,apellido:!1,segundoApellido:!1,verificarSiEsElUsuario:!0}),E(!1),g({open:!0,message:"Se actualizó el perfil correctamente",severity:"success"})):g({open:!0,message:(r==null?void 0:r.message)||"La contraseña de verificación es incorrecta",severity:"info"})}catch(r){console.error(r),g({open:!0,message:"Error al actualizar los datos de la cuenta",severity:"error"})}};return e.jsx(R,{open:c,onClose:()=>{m(!1),f({nombreCuenta:!1,contrasena:!1,repetirContrasena:!1,correo:!1,nombre:!1,apellido:!1,segundoApellido:!1,verificarSiEsElUsuario:!1}),E(!0)},children:e.jsxs(s,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",maxHeight:"99vh",width:"calc(5vw + 20rem)",bgcolor:"white",boxShadow:24,borderRadius:"16px",overflowY:"auto"},children:[e.jsxs(s,{sx:{backgroundColor:"#114093",color:"white",textAlign:"center",padding:"10px",borderRadius:"16px 16px 0 0"},children:[e.jsx(W,{fontSize:"large"}),e.jsx(C,{variant:"h6",children:i}),e.jsx(C,{variant:"body2",children:n.toString().toUpperCase()})]}),e.jsx(z,{initialValues:S,validationSchema:D,enableReinitialize:!0,onSubmit:L,children:({values:a,handleChange:t,errors:o,touched:r,resetForm:q,setFieldValue:w})=>e.jsxs(M,{children:[e.jsx(s,{display:"flex",alignContent:"center",justifyContent:"center",children:e.jsxs(s,{sx:{margin:"2rem",marginBottom:"0rem",marginTop:"0.5rem"},children:[e.jsx(C,{variant:"h6",sx:{marginBottom:"0.5rem"},children:"Datos cuenta:"}),[{name:"nombreCuenta",label:"Nombre Cuenta"},{name:"correo",label:"Correo"},{name:"nombre",label:"Nombre"}].map(l=>e.jsxs(s,{display:"flex",alignItems:"center",sx:{marginBottom:"0.5rem"},children:[e.jsx(u,{name:l.name,disabled:!p[l.name],value:a[l.name],onChange:t,error:r[l.name]&&!!o[l.name],helperText:r[l.name]&&o[l.name],label:l.label,fullWidth:!0}),x&&e.jsx(j,{onClick:()=>v(l.name,w),sx:{marginLeft:"8px"},children:e.jsx(y,{})})]},l.name)),e.jsxs(s,{display:"flex",children:[e.jsx(u,{name:"apellido",disabled:!p.apellido,value:a.apellido,onChange:t,error:r.apellido&&!!o.apellido,helperText:r.apellido&&o.apellido,label:"Apellido",fullWidth:!0}),e.jsx(u,{name:"segundoApellido",disabled:!p.segundoApellido,value:a.segundoApellido,onChange:t,error:r.segundoApellido&&!!o.segundoApellido,helperText:r.segundoApellido&&o.segundoApellido,label:"Segundo Apellido",fullWidth:!0}),x&&e.jsx(j,{onClick:()=>v("segundoApellido",w),sx:{marginLeft:"0.5rem"},children:e.jsx(y,{})})]}),e.jsxs(s,{display:"flex",sx:{marginTop:"0.5rem"},children:[e.jsx(u,{name:"contrasena",disabled:!p.contrasena,value:a.contrasena,onChange:t,error:r.contrasena&&!!o.contrasena,helperText:r.contrasena&&o.contrasena,label:"Nueva Contraseña",fullWidth:!0,type:"password"}),e.jsx(u,{name:"repetirContrasena",disabled:!p.repetirContrasena,value:a.repetirContrasena,onChange:t,error:r.repetirContrasena&&!!o.repetirContrasena,helperText:r.repetirContrasena&&o.repetirContrasena,label:"Repetir Contraseña",fullWidth:!0,type:"password"}),x&&e.jsx(j,{onClick:()=>v("repetirContrasena",w),sx:{marginLeft:"0.5rem"},children:e.jsx(y,{})})]})]})}),e.jsx(s,{marginLeft:"2rem",marginRight:"2rem",children:x&&e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"h6",children:"Verificación:"}),e.jsx(s,{display:"flex",sx:{marginBottom:"1rem"},children:e.jsx(u,{name:"verificarSiEsElUsuario",value:a.verificarSiEsElUsuario,onChange:t,error:r.verificarSiEsElUsuario&&!!o.verificarSiEsElUsuario,helperText:r.verificarSiEsElUsuario&&o.verificarSiEsElUsuario,fullWidth:!0,type:"password"})})]})}),e.jsx(s,{margin:"2rem",marginTop:"0.5rem",marginBottom:"1rem",children:e.jsx(s,{display:"flex",justifyContent:"flex-end",children:x?e.jsxs(s,{display:"flex",sx:{width:"100%"},children:[e.jsx(T,{variant:"outlined",sx:{flexGrow:"1"},onClick:()=>{E(!1),q(),f({nombreCuenta:!1,contrasena:!1,repetirContrasena:!1,correo:!1,nombre:!1,apellido:!1,segundoApellido:!1,verificarSiEsElUsuario:!1})},children:"Cancelar"}),e.jsx(T,{type:"submit",variant:"contained",sx:{flexGrow:"1",marginLeft:"0.2rem"},children:"Confirmar"})]}):e.jsx(j,{variant:"contained",sx:{backgroundColor:"#114093",color:"white","&:hover":{backgroundColor:"#003289"}},onClick:()=>E(!0),children:e.jsx(y,{})})})})]})}),e.jsx(N,{openSnackbar:h.open,setOpenSnackbar:a=>g({...h,open:a}),message:h.message,severity:h.severity})]})})};export{J as default};
